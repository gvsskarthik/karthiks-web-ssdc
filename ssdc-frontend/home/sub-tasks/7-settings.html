<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../../vendor/fonts/fonts.css" rel="stylesheet">
    <link href="../../vendor/boxicons/css/boxicons.min.css" rel="stylesheet">

    <link rel="stylesheet" href="theme.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="7-settings.css">

    <title>Settings</title>
</head>
<body>
    <div class="page">
        <div class="head-title">
            <div>
                <h1>Settings</h1>
                <div class="subtitle">Lab profile and preferences</div>
            </div>
        </div>

        <div class="neo card">
            <div class="card-head">
                <div>
                    <h3>Lab Name</h3>
                    <div class="hint">This name appears on dashboard, reports, bills &amp; exports.</div>
                </div>

                <div class="card-actions">
                    <button class="btn secondary" type="button" id="editLabNameBtn">
                        <i class="bx bx-edit-alt"></i> Edit
                    </button>
                    <button class="btn" type="button" id="saveLabNameBtn" hidden>
                        <i class="bx bx-save"></i> Save
                    </button>
                    <button class="btn secondary" type="button" id="cancelLabNameBtn" hidden>
                        <i class="bx bx-x"></i> Cancel
                    </button>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label class="small" for="labNameInput">Lab Name</label>
                    <input id="labNameInput" class="neo-input neo-pressed" placeholder="Lab Name" spellcheck="false" disabled>
                </div>
            </div>

            <div id="labNameStatus" class="status-text"></div>
        </div>

        <div class="neo card">
            <div class="card-head">
                <div>
                    <h3>Security</h3>
                    <div class="hint">Change your password. You will be logged out on all tabs.</div>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label class="small" for="currentPasswordInput">Current Password</label>
                    <div class="password-field">
                        <input id="currentPasswordInput" class="neo-input neo-pressed" type="password" autocomplete="current-password" placeholder="Current password">
                        <button class="icon-btn" type="button" id="toggleCurrentPasswordBtn" aria-label="Show password">
                            <i class="bx bx-show"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="small" for="newPasswordInput">New Password</label>
                    <div class="password-field">
                        <input id="newPasswordInput" class="neo-input neo-pressed" type="password" autocomplete="new-password" placeholder="New password (min 6 chars)">
                        <button class="icon-btn" type="button" id="toggleNewPasswordBtn" aria-label="Show password">
                            <i class="bx bx-show"></i>
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label class="small" for="confirmPasswordInput">Confirm New Password</label>
                    <div class="password-field">
                        <input id="confirmPasswordInput" class="neo-input neo-pressed" type="password" autocomplete="new-password" placeholder="Confirm new password">
                        <button class="icon-btn" type="button" id="toggleConfirmPasswordBtn" aria-label="Show password">
                            <i class="bx bx-show"></i>
                        </button>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn" type="button" id="changePasswordBtn" disabled>
                        <i class="bx bx-key"></i> Change Password
                    </button>
                </div>
            </div>

            <div id="passwordStatus" class="status-text"></div>
        </div>

        <div class="neo card">
            <div class="card-head">
                <div>
                    <h3>Authenticator App Verification</h3>
                    <div class="hint">Protect sign-in with a 6-digit code from your authenticator app.</div>
                </div>
                <div class="card-actions">
                    <span id="twoFactorBadge" class="status-pill">Loading...</span>
                </div>
            </div>

            <div id="twoFactorEnabledMeta" class="hint"></div>

            <div id="twoFactorSetupSection" class="twofactor-section">
                <div class="form-grid">
                    <div class="form-group">
                        <label class="small" for="twoFactorSetupPasswordInput">Current Password</label>
                        <div class="password-field">
                            <input id="twoFactorSetupPasswordInput" class="neo-input neo-pressed" type="password" autocomplete="current-password" placeholder="Current password">
                            <button class="icon-btn" type="button" id="toggleTwoFactorSetupPasswordBtn" aria-label="Show password">
                                <i class="bx bx-show"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button class="btn" type="button" id="twoFactorStartSetupBtn">
                            <i class="bx bx-shield-plus"></i> Generate Setup
                        </button>
                    </div>
                </div>

                <div id="twoFactorSetupResult" class="twofactor-setup-result" hidden>
                    <div class="hint">Step 1: Add this key in your authenticator app.</div>
                    <div class="twofactor-key-row">
                        <input id="twoFactorManualKeyInput" class="neo-input neo-pressed mono-input" type="text" readonly>
                        <button class="btn secondary" type="button" id="copyTwoFactorManualKeyBtn">
                            <i class="bx bx-copy"></i> Copy
                        </button>
                    </div>
                    <a id="twoFactorOtpAuthLink" class="text-link" href="#" target="_blank" rel="noopener noreferrer" hidden>
                        Open authenticator app link
                    </a>
                    <div id="twoFactorSetupExpiresText" class="hint"></div>

                    <div class="form-grid">
                        <div class="form-group">
                            <label class="small" for="twoFactorEnableCodeInput">Verification Code</label>
                            <input id="twoFactorEnableCodeInput" class="neo-input neo-pressed code-input" type="text" inputmode="numeric" autocomplete="one-time-code" maxlength="6" placeholder="123456">
                        </div>
                        <div class="form-actions">
                            <button class="btn" type="button" id="twoFactorEnableBtn" disabled>
                                <i class="bx bx-check-shield"></i> Enable 2FA
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="twoFactorDisableSection" class="twofactor-section" hidden>
                <div class="form-grid">
                    <div class="form-group">
                        <label class="small" for="twoFactorDisablePasswordInput">Current Password</label>
                        <div class="password-field">
                            <input id="twoFactorDisablePasswordInput" class="neo-input neo-pressed" type="password" autocomplete="current-password" placeholder="Current password">
                            <button class="icon-btn" type="button" id="toggleTwoFactorDisablePasswordBtn" aria-label="Show password">
                                <i class="bx bx-show"></i>
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="small" for="twoFactorDisableCodeInput">Authenticator Code</label>
                        <input id="twoFactorDisableCodeInput" class="neo-input neo-pressed code-input" type="text" inputmode="numeric" autocomplete="one-time-code" maxlength="6" placeholder="123456">
                    </div>

                    <div class="form-actions">
                        <button class="btn danger" type="button" id="twoFactorDisableBtn" disabled>
                            <i class="bx bx-shield-minus"></i> Disable 2FA
                        </button>
                    </div>
                </div>
            </div>

            <div id="twoFactorStatusText" class="status-text"></div>
        </div>
    </div>

    <script defer src="../../api.js"></script>
    <script defer src="7-settings.js"></script>
</body>
</html>
